<!DOCTYPE html>
<html>
<head>
  <title>Configit Model - Web modeller</title>
  <link rel="stylesheet" type="text/css" href="./resources/ui.css" />
  <link rel="stylesheet" type="text/css" href="./resources/ui-common.css" />
  <link rel="stylesheet" type="text/css" href="./resources/ui-default.css" />
  <script type="text/javascript" src="./build/waspioc.js"></script>
  <script type="text/javascript">
    window.addEventListener('load', function() {
      var context = waspioc.core.ioc.ServiceContext.getCurrentContext();

      function TestModule() {
        this.getBeanTypes = function() {
          return [waspioc.core.ioc.BeanType.MODULE];
        };

        this.initializeContext = function(context) {
          function UT_ContextInitiated() {
            this.logger = '';
            this.serviceContext = '';

            this.afterStarted = function() {
              // get the viewmodel
              var bean = this.serviceContext.getItem('viewModel');
              var match = this.serviceContext.getItem('singleItem') === bean.item.complex;
              this.logger.log('instance bean matches bean property? ' + (match ? "yes" : "no") );
              bean.newValue = 'yeehaw';
              var bean2 = this.serviceContext.getItem('viewModel');
              this.logger.log('same bean names = same instance? ' + (bean === bean2 ? "yes": "no") );
              // finished
              this.serviceContext.dispose();
            };
          }

          function ViewModel() {
            this.viewBag = 4;

            this.afterPropertiesSet = function() {
              this.viewBag = 8;
            };
          }

          /* register bean interfaces */
          UT_ContextInitiated.prototype.getBeanTypes = function() {
            return [waspioc.core.ioc.BeanType.STARTING];
          };

          ViewModel.prototype.getBeanTypes = function() {
            return [waspioc.core.ioc.BeanType.INITIALIZING];
          };

          /* unit test setup */
          var item = {
            test: 'A',
            prop: 5
          };

          // register unit test (should be the same if it's first or last)
          context.register('unit_test_context', UT_ContextInitiated);
          // register context
          context.registerInstance('singleItem', item);
          context.register('item', item.constructor).value('test', 'A').reference('complex', 'singleItem');
          context.register('viewModel', ViewModel).reference('item', 'item');

          context.registerProperty('logger', console);
          context.registerProperty('serviceContext', context);
        }
      }

      context.registerModule('screenModule', new TestModule());
      // start the context
      context.start();
    });
  </script>
</head>
<body>
</body>
</html>
